"use strict";
const fs = require("fs").promises;
const MSG_FILE_PATH = "mnt/msg/content";
exports.handler = async (event) => {
    console.log(event);
    const method = event.requestContext.http.method;
    if (method === "GET") {
        return sendRes(200, await getMessages());
    }
    else if (method === "POST") {
        await createMessage(event.body);
        return sendRes(200, await getMessages());
    }
    else if (method === "DELETE") {
        await deleteMessages();
        return sendRes(200, await getMessages());
    }
    else {
        return sendRes(200, "Method unsupported");
    }
};
const createMessage = async (message) => {
    try {
        await fs.appendFile(MSG_FILE_PATH, message + "\n");
    }
    catch (error) {
        console.log("error in creating msg", error);
    }
};
const getMessages = async () => {
    try {
        return await fs.readFile(MSG_FILE_PATH, "utf8");
    }
    catch (error) {
        console.log("error in getting messages", error);
    }
};
const deleteMessages = async () => {
    console.log("delete all messages");
    try {
        await fs.unlink(MSG_FILE_PATH);
    }
    catch (error) {
        console.log("error in deleting", error);
    }
};
const sendRes = (status, body) => {
    var response = {
        statusCode: status,
        body: body,
    };
    return response;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXNnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibXNnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDO0FBRWxDLE1BQU0sYUFBYSxHQUFHLGlCQUFpQixDQUFDO0FBRXhDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQVUsRUFBRSxFQUFFO0lBQ3JDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkIsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRWhELElBQUksTUFBTSxLQUFLLEtBQUssRUFBRTtRQUNwQixPQUFPLE9BQU8sQ0FBQyxHQUFHLEVBQUUsTUFBTSxXQUFXLEVBQUUsQ0FBQyxDQUFDO0tBQzFDO1NBQU0sSUFBSSxNQUFNLEtBQUssTUFBTSxFQUFFO1FBQzVCLE1BQU0sYUFBYSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxPQUFPLE9BQU8sQ0FBQyxHQUFHLEVBQUUsTUFBTSxXQUFXLEVBQUUsQ0FBQyxDQUFDO0tBQzFDO1NBQU0sSUFBSSxNQUFNLEtBQUssUUFBUSxFQUFFO1FBQzlCLE1BQU0sY0FBYyxFQUFFLENBQUM7UUFDdkIsT0FBTyxPQUFPLENBQUMsR0FBRyxFQUFFLE1BQU0sV0FBVyxFQUFFLENBQUMsQ0FBQztLQUMxQztTQUFNO1FBQ0wsT0FBTyxPQUFPLENBQUMsR0FBRyxFQUFFLG9CQUFvQixDQUFDLENBQUM7S0FDM0M7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLGFBQWEsR0FBRyxLQUFLLEVBQUUsT0FBZSxFQUFFLEVBQUU7SUFDOUMsSUFBSTtRQUNGLE1BQU0sRUFBRSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDO0tBQ3BEO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQzdDO0FBQ0gsQ0FBQyxDQUFDO0FBQ0YsTUFBTSxXQUFXLEdBQUcsS0FBSyxJQUFJLEVBQUU7SUFDN0IsSUFBSTtRQUNGLE9BQU8sTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxNQUFNLENBQUMsQ0FBQztLQUNqRDtJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsRUFBRSxLQUFLLENBQUMsQ0FBQztLQUNqRDtBQUNILENBQUMsQ0FBQztBQUVGLE1BQU0sY0FBYyxHQUFHLEtBQUssSUFBSSxFQUFFO0lBQ2hDLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUNuQyxJQUFJO1FBQ0YsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0tBQ2hDO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQ3pDO0FBQ0gsQ0FBQyxDQUFDO0FBRUYsTUFBTSxPQUFPLEdBQUcsQ0FBQyxNQUFjLEVBQUUsSUFBUyxFQUFFLEVBQUU7SUFDNUMsSUFBSSxRQUFRLEdBQUc7UUFDYixVQUFVLEVBQUUsTUFBTTtRQUNsQixJQUFJLEVBQUUsSUFBSTtLQUNYLENBQUM7SUFDRixPQUFPLFFBQVEsQ0FBQztBQUNsQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKS5wcm9taXNlcztcblxuY29uc3QgTVNHX0ZJTEVfUEFUSCA9IFwibW50L21zZy9jb250ZW50XCI7XG5cbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIChldmVudDogYW55KSA9PiB7XG4gIGNvbnNvbGUubG9nKGV2ZW50KTtcbiAgY29uc3QgbWV0aG9kID0gZXZlbnQucmVxdWVzdENvbnRleHQuaHR0cC5tZXRob2Q7XG5cbiAgaWYgKG1ldGhvZCA9PT0gXCJHRVRcIikge1xuICAgIHJldHVybiBzZW5kUmVzKDIwMCwgYXdhaXQgZ2V0TWVzc2FnZXMoKSk7XG4gIH0gZWxzZSBpZiAobWV0aG9kID09PSBcIlBPU1RcIikge1xuICAgIGF3YWl0IGNyZWF0ZU1lc3NhZ2UoZXZlbnQuYm9keSk7XG4gICAgcmV0dXJuIHNlbmRSZXMoMjAwLCBhd2FpdCBnZXRNZXNzYWdlcygpKTtcbiAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwiREVMRVRFXCIpIHtcbiAgICBhd2FpdCBkZWxldGVNZXNzYWdlcygpO1xuICAgIHJldHVybiBzZW5kUmVzKDIwMCwgYXdhaXQgZ2V0TWVzc2FnZXMoKSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHNlbmRSZXMoMjAwLCBcIk1ldGhvZCB1bnN1cHBvcnRlZFwiKTtcbiAgfVxufTtcblxuY29uc3QgY3JlYXRlTWVzc2FnZSA9IGFzeW5jIChtZXNzYWdlOiBzdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy5hcHBlbmRGaWxlKE1TR19GSUxFX1BBVEgsIG1lc3NhZ2UgKyBcIlxcblwiKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmxvZyhcImVycm9yIGluIGNyZWF0aW5nIG1zZ1wiLCBlcnJvcik7XG4gIH1cbn07XG5jb25zdCBnZXRNZXNzYWdlcyA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgZnMucmVhZEZpbGUoTVNHX0ZJTEVfUEFUSCwgXCJ1dGY4XCIpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgaW4gZ2V0dGluZyBtZXNzYWdlc1wiLCBlcnJvcik7XG4gIH1cbn07XG5cbmNvbnN0IGRlbGV0ZU1lc3NhZ2VzID0gYXN5bmMgKCkgPT4ge1xuICBjb25zb2xlLmxvZyhcImRlbGV0ZSBhbGwgbWVzc2FnZXNcIik7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMudW5saW5rKE1TR19GSUxFX1BBVEgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgaW4gZGVsZXRpbmdcIiwgZXJyb3IpO1xuICB9XG59O1xuXG5jb25zdCBzZW5kUmVzID0gKHN0YXR1czogbnVtYmVyLCBib2R5OiBhbnkpID0+IHtcbiAgdmFyIHJlc3BvbnNlID0ge1xuICAgIHN0YXR1c0NvZGU6IHN0YXR1cyxcbiAgICBib2R5OiBib2R5LFxuICB9O1xuICByZXR1cm4gcmVzcG9uc2U7XG59O1xuIl19